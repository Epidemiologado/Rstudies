# Exercícios que utilizam a base de dados lowbwt

# O conjunto de dados lowbwt contém informação registrada para uma amostra de 100 bebês com baixo peso ao nascer, nascidos
# em dois hospitais escolas em Boston, Massachussets. As medidas de pressão sanguínea sistólica estão salvas sob a variável de nome sbp,
# enquando indicadores do sexo - onde 1 representa menino e 0 uma menina - estão salvos sobre o nome sex. Os Valores do escore Apgar - 
# um índice de asfixia neonatal ou privação de oxigênio - registrados cinco minutos após o nascimento estão salvos sob a variável de 
# nome apgar5. O escore Apgar é uma variável aleatória ordinal que assume valores entre 0 e 10. Indicadores de um diagnóstico de toxemia
# durante a gravidez - condição caracterizada por pressão sanguínea alta e outras complicações potencialmente sérias - estão salvos sob
# uma variável de nome tox. Os valores de idade gestacional está sob o nome gestage. A variável grhem é uma variável aleatória dicotômica
# que indica se o bebê teve hemorragia na matriz germinal.

lowbwt <- read.table("lowbwt.txt", head=T, sep="", dec=".")
attach(lowbwt)
class(lowbwt)
names(lowbwt)
print(lowbwt)


# Cap. 3 - Medidas-Resumo Numéricas
# Questão 15

# a) Construa um par de box plot para as medidas de pressão sanguínea sistólica - uma para meninos e outra para meninas. Compare as duas
# distribuição de valores

boxplot(sbp~sex, data=lowbwt)

# b) Calcule a média e o desvio-padrão das medidas de pressão sanguínea sistólica para meninos e meninas. Que grupo tem a maior média? 
# E o maior desvio padrão?

lowglr <- lowbwt[lowbwt$sex ==1,]
lowboy <- lowbwt[lowbwt$sex ==0,]

mean(lowboy$sbp)
sd(lowboy$sbp)
mean(lowglr$sbp)
sd(lowglr$sbp)

# Outra maneira de responder é utilizar o pacote psych

library(psych)
describeBy(lowbwt, lowbwt$sex)

# c) Calcule o coeficiente de variação que corresponde a cada sexo. Há alguma evidência de que a variabilidade na pressão sanguínea
# sistólica difere para meninos e meninas?

cvboy <- sd(lowboy$sbp)/mean(lowboy$sbp)
cvglr <- sd(lowglr$sbp)/mean(lowglr$sbp)

print(cvboy)
print(cvglr)

# Cap. 9 -  Intervalos de Confiança
# Questão 13

# a) Cacule o intervalo de confiança de 95% para a pressão sanguínea sistólica média verdadeira de bebês do sexo masculino com baixo
# peso ao nascer.

t.test(lowboy$sbp)

# b) Calcule um intervalo de confiança de 95% para pressão sanguínea sistólica média verdadeira de bebês do sexo feminino com baixo
# peso ao nascer.

t.test(lowglr$sbp)

# c) Você acha que é possível meninos e meninas terem a mesma pressão sanguínea sistólica média? Explique brevemente

# Cap 11. - Comparação de Duas Médias
# Questão 15 

# a) Construa um histograma das medidas de pressão sanguínea sistólica para essas amostra. Com base no gráfico, você acredita que a 
# pressão sanguínea tenha distribuição aproximadamente normal?

hist(lowbwt$sbp)

# b) Teste a hipótese nula de que entre os bebês com baixos pesos ao nascer, a pressão sanguínea sistólica média para meninos seja igual
# à média para as meninas. Use um test bilateral ao nível de significância de 0,05. O que você conclui?

 t.test(sbp~sex, data=lowbwt, alternative="two.sided")


# Cap 12 - Análise de Variância
# Questão 11.

# a) Assumindo variâncias iguais para meninos e meninas, use o teste-t de duas amostras para avaliar a hipótese nula de que, entre os 
# bebês com baixo peso ao nascer, a pressão sanguínea sistólica média das meninas é identica à dos meninos.

 t.test(lowglr$sbp, lowboy$sbp, alternative="two.sided")
 
 # b) Embora haja somente duas populações em vez de três ou mais, teste a mesma hipótese nula, usando a análise de variância como fator.
 
 aov(sbp~sex, data=lowbwt)
 
 # c) Nesse texto, foi feita a afirmação de que, no caso de duas amostras independentes, o teste-F usado na análise de variância com um 
 # fator se reduz ao teste-t de duas amostras. Você acredita que essa afirmação seja verdadeira? Explique brevemente.
 
 # Cap 13 - Métodos Não-paramétricos.
 # questão 15
 
 # a) construa um par de box plots do escore Apgar de 5 minutos para bebês masculinos e femininos.
 
 boxplot(apgar5~sex, data=lowbwt)
 
 # b) Teste a hipótese nula de que entre os bebês com baixo peso ao nascer, o escore Apgar mediano para meninos é igual ao escore médiano
 # para as meninas. O que você conclui?
 
 # A comparação de mediana é feita utilizando testes não-paramétricos. No caso utiliza-se o teste de postos sinalizados de Wilcox.
 # Na função wilcox.test aponta-se TRUE em paired para que se aplique o teste de postos sinalizados, e não o teste de somas (default).
 # O teste de somas de postos é a adequado quando as amostras são extraídas de populações independentes, o que não se aplica.
 # 
 
 wilcox.test(apgar5~sex, data=lowbwt, paired=TRUE)
 
 # Cap. 14 - Inferência sobre proporções
 # Questão 13
 
 # a) Estime a proporção de bebês nascidos com baixo peso, cujas mães sofreram de toxemia durante a gravidez.
 
 library(MASS)
 tox = na.omit(lowbwt$tox)
 n = length(tox)
 k = sum(tox == 1)
 
 proptox = k/n 
 
 proptox
 
 # b) Construa um intervalo de confiança de 95% para a verdaira proporção da população p.
 
p = proptox
 
# erro padrão
 
 ep = sqrt(p*(1-p)/n)
 ep
 
 # margem de erro
 
 zab = qnorm(.975)
 
 me = zab*ep 
 
 # Intervalo de confiança para proporção
 
 p + c(-me,me)
 
 # Esse é um intervalo exato de confiança ou se baseia na aproximação normal para a distribuição binomial?
 
 # Cap. 17 - Correlação
 # Questão 7.
 
 # a) Estime correlação das variáveis aleatórias pressão sanguínea sistólica e escore Apgar de cinco minutos para essa população de 
 # bebês nascidos com baixo peso.
 
 cor(lowbwt$sbp, lowbwt$apgar5, method="spearman")
 
 # b) O escore Apgar tende a aumentar ou diminuir conforme aumenta a pressão sanguínea sistólica?
 
 # c) Teste a hipótese nula.
 # h0: p = 0
 # O que você conclui?
 
 cor.test(lowbwt$sbp, lowbwt$apgar5, method="spearman")
 
 # Cap. 18 - Regressão Linear Simples
 # Questão 9.
 
 # a) Construa um gráfico de dispersão bidimensional da pressão sanguínea sistolica versus a idade gestacional. O gráfico faz sugestões
 # sobre a natureza da relação entre essas variáveis?
 
  plot(lowbwt$sbp, lowbwt$gestage)
  
  # b) Usando a pressão sanguínea sistólica como resposta e a idade gestacional como variável explicativa, calcule a linha de regressão 
  # de mínimos quadrados. Interprete a inclinação e o intecepto y estimados da linha; o que significam, em palavras?
  
lm(sbp~gestage, data=lowbwt)
 
 # c) Ao nível de significância de 0,05, teste a hipótele nula de que a verdadeira inclinação beta da população é igual a 0. O que você
 # conclui?
 
    linear = lm(lowbwt$sbp~lowbwt$gestage)

 summary(linear)
 
 # d) Qual a pressão sanguínea sistólica média estimada para a população de bebês nascidos com baixo peso com idade gestacional de 31
 # semanas?
 
 # Basta multiplicar o valor de 31 pelo beta da inclinação (os coeficientes do modelo)
 
 x = 31*coef(linear)
 
 # e) Construa um intervalo de confiança de 95% para o valor médio verdadeiro da perssão sanguínea sistólica quando x= 31 semanas)

confint(linear,'lowbwt$gestage',level=0.95)

# f) Suponha que você selecione aleatoriamente uma nova criança da população de bebês nascidos com baixo peso com idade gestacional de 
# 31 semanas. Qual a pressão sanguínea sistólica prevista para essa criança?


# g) Construa um intervalo de predição de 95% para esse novo valor da pressão sangúinea sistólica.

# h) O modelo de regressão de mínimos quadrados parece se ajustar aos dados observados? Comente os coeficientes de determinação e um
# um gráfico dos resíduos versus os valores ajustados da pressão sanguínea sistólica.

# Cap. 19 - Regressão Múltipla
# Questão 9

# a) Adicione a variável indicadora sex - na qual 1 representa masculino e 0 feminino - ao modelo que contém a idade gestacional. Dada
# duas crianças com idade gestacional idênticas, uma masculina e outra feminina, qual tenderia a ter pressão sanguínea sistólica maior?
# Por quanto, em média?

# b) Construa um gráfico de dispersão bidimensional da pressão sanguínea sistólica versus a idade gestacional e desenhe as duas linhas 
# de regressão de mínimos quadrados separadas que correspondem aos bebês masculinos e femininos. A diferença na pressão sanguínea sis-
# tólica para cada valor da idade gestacional é significativamente diferente de 0 para os dois sexos?

# c) Adicione ao modelo uma terceira variável explicativa que é a interação entre a idade gestacional e o sexo. A idade gestacional tem
# efeito diferente na pressão sanguínea sistólica, dependendo do sexo do bebê?

# d) Você optaria por incluir o sexo e o termo de interação idade gestacional - sexo, simultaneamente, no modelo de regressão? Por quê?

# Cap. 20 - Regressão Logística
# Questão 7.

# a) Usando a hemorragia da matriz germinal como resposta, ajuste o modelo e regressão logística da forma 
# ln(p/1-p) = alpha + beta1*x1
# na qual x1 é um escore apgar de cinco minutos. Interprete beta, o coeficiente estimado do escore apgar.

logistico = glm(lowbwt$grmhem~lowbwt$apgar5,family=binomial(link="logit"))

summary(logistico)

# b) Se determinada criança tem escore apgar de cinco minutos de 3, qual a probabilidade prevista de que ela tenha hemorragia no cérebro?
# Qual a probabilidade se o escore da criança é 7?

# c) Ao nível de significância de 0.05, teste a hipótese nula de que o parâmetro beta da população é igual a 0. O que você conclui?

testeanova <- aov(logistico)

summary(testeanova)

# d) Agora ajuste o modelo de regressão
# ln(p/1-p)=alpha+beta2X2
# onde x, representa o status de toxemia. Interprete beta, o coeficiente estimado de toxemia.

logistico2 <- glm(lowbwt$grmhem~lowbwt$tox, family=binomial(link="logit"))

# e) Para uma criança cuja mãe foi diagnosticada com toxemia durante a gravidez, qual a possibilidade prevista de ela ter hemorragia de
# matriz germinal? Qual a probabilidade para uma criança cuja mãe foi diagnosticada com toxemia?

tab.freq <- table(lowbwt$grmhem, lowbwt$tox)

tab.freq

a = 64
b = 14
c = 20
d = 1



# f) Qual a chance estimada de haver uma hemorragia da matriz germinal em crianças cujas mães foram diagnosticadas com toxemia relativa
# às crianças cujas mães não foram diagnosticadas?


# g) construa um intervalo de confiança de 95% para a razão de chances da população. Esse intervalo contém o valor de 1? O que isso
# lhe diz?

oddsratio(a,b,c,d, conf.level=0.95)
oddsratio(65,14,20,1, conf.level=0.95)







 
 
 
 
 
 
 
 
 
 







